---
title: "Inflation Graphs"
author: "Camille Bergeron"
date: "August 2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)

# libraries 
rm(list  = ls())
library(plotly)
library(tidyverse)
library(readxl)
library(knitr)
library(lubridate)
```


```{r}
# labeling directories 
proj_dir <-  "C:/Users/camilleb/Documents/GitHub/BPDA-home"
proj_folder_dir <- "C:/Users/camilleb/Box/Research/Active Projects/Mastercard/Program/Inflation"

```

```{r}
# loading in data
txn_amt_adj <- read_xlsx(paste0(proj_folder_dir, "/in_person_spending.xlsx"), sheet = "txn_amt_adj")
txn_amt <- read_xlsx(paste0(proj_folder_dir, "/in_person_spending.xlsx"), sheet = "txn_amt")
txn_cnt <- read_xlsx(paste0(proj_folder_dir, "/in_person_spending.xlsx"), sheet = "txn_cnt")

spending_dat <- cbind(txn_cnt %>% mutate(txn_cnt = as.numeric(count)) %>% select(-count), 
      txn_amt %>% mutate(txn_amt = as.numeric(count)) %>% select(txn_amt), 
      txn_amt_adj %>% mutate(txn_amt_adj = as.numeric(count)) %>% select(txn_amt_adj))


```


# Graphing 

```{r}
# writing a function to plot the graphs by industry 


graphing_fxn <- function(ind) {
  p <- spending_dat %>% filter(industry == paste0(ind)) %>%
    plot_ly(
    x = ~date, 
    y = ~txn_cnt, name = "Counts", 
    type = 'scatter', mode = 'lines'
  ) %>%
    add_trace(y = ~txn_amt, name = "Amount ($)") %>%
    add_trace(y = ~txn_amt_adj, name = 'Adj. Amount ($)') %>%
    layout(yaxis = list(title = "Index"),
           xaxis = list(title = "Date"))
  
  return(p)
}


graphing_fxn_ggplot <- function(ind) {
  p <- spending_dat %>% filter(industry == paste0(ind)) %>%
    pivot_longer(cols = starts_with("txn"), names_to = "label", values_to = "idx") %>%
    ggplot(aes(x = date)) +
    geom_line(aes(y = idx, group = label, color = label)) +
    labs(y = "Value", x = "Date") +
    geom_hline(yintercept = 0, color = "black") +
    theme(legend.position = "bottom")
  
  return(p)
}

```


## All Spending

+ Combined / weighted for all included goods for "all spending"? Or use general city - average inflation rate

```{r}
# graphing_fxn("ret")
graphing_fxn_ggplot("ret")
```


## Groceries

```{r}
# adjusting the grocery numbers 
# graphing_fxn("gro")
graphing_fxn_ggplot("gro")

```

## Resturants 

```{r}
#graphing_fxn("eap")
graphing_fxn_ggplot("eap")
```

## Apparel 

```{r}
# graphing_fxn("app")
graphing_fxn_ggplot("app")
```
